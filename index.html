<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¹´í†¡ ë‹µì¥ ë„ìš°ë¯¸ - Solar AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .chat-container { height: calc(100vh - 280px); }
        @media (max-width: 640px) { .chat-container { height: calc(100vh - 320px); } }
    </style>
</head>
<body class="bg-gradient-to-br from-yellow-50 to-orange-50 min-h-screen">
    <div class="flex flex-col h-screen">
        <!-- í—¤ë” -->
        <header class="bg-gradient-to-r from-yellow-400 to-orange-400 text-white p-4 shadow-lg">
            <div class="max-w-3xl mx-auto">
                <h1 class="text-2xl font-bold">ğŸ’¬ ì¹´í†¡ ë‹µì¥ ë„ìš°ë¯¸</h1>
                <p class="text-yellow-100 text-sm mt-1">ìƒì‚¬ì—ê²Œ ë­ë¼ê³  ë‹µì¥í• ì§€ ê³ ë¯¼ë  ë•Œ, Solar AIê°€ ë„ì™€ë“œë ¤ìš”</p>
            </div>
        </header>

        <!-- í†¤ ì„ íƒ -->
        <div class="bg-white border-b shadow-sm p-3">
            <div class="max-w-3xl mx-auto">
                <p class="text-sm text-gray-600 mb-2 font-medium">ë‹µì¥ í†¤ ì„ íƒ:</p>
                <div class="flex gap-2 flex-wrap" id="tone-buttons">
                    <button onclick="setTone('polite')" id="tone-polite" class="tone-btn px-4 py-2 rounded-full text-sm font-medium bg-orange-500 text-white shadow-md">ğŸ™‡ ë§¤ìš° ê³µì†</button>
                    <button onclick="setTone('neutral')" id="tone-neutral" class="tone-btn px-4 py-2 rounded-full text-sm font-medium bg-gray-100 text-gray-700 hover:bg-gray-200">ğŸ˜Š ì¤‘ë¦½ì </button>
                    <button onclick="setTone('active')" id="tone-active" class="tone-btn px-4 py-2 rounded-full text-sm font-medium bg-gray-100 text-gray-700 hover:bg-gray-200">ğŸ’ª ì ê·¹ì </button>
                </div>
            </div>
        </div>

        <!-- ì±„íŒ… ì˜ì—­ -->
        <div class="flex-1 overflow-y-auto p-4 chat-container" id="chat-container">
            <div class="max-w-3xl mx-auto space-y-4" id="messages">
                <div class="flex justify-start">
                    <div class="max-w-[85%] rounded-2xl p-4 shadow-md bg-white text-gray-800 border">
                        <p class="text-sm leading-relaxed">ì•ˆë…•í•˜ì„¸ìš”! ğŸ“± ì¹´í†¡ ë‹µì¥ ë„ìš°ë¯¸ì…ë‹ˆë‹¤.<br><br>ìƒì‚¬ì™€ì˜ ì¹´í†¡ ëŒ€í™” ë‚´ìš©ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.<br><br><span class="text-gray-500">ì˜ˆì‹œ:<br>íŒ€ì¥: ê¹€ëŒ€ë¦¬ ë‚´ì¼ê¹Œì§€ ë³´ê³ ì„œ ê°€ëŠ¥í•´?<br>ë‚˜: ë„¤ ì–´ë–¤ ë³´ê³ ì„œìš”?<br>íŒ€ì¥: ì§€ë‚œì£¼ ë¯¸íŒ… ê²°ê³¼ ì •ë¦¬í•´ì„œ ë³´ê³ í•´ì•¼í•´</span></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ì…ë ¥ ì˜ì—­ -->
        <div class="bg-white border-t shadow-lg p-4">
            <div class="max-w-3xl mx-auto">
                <div class="flex gap-2 items-end">
                    <textarea id="text-input" placeholder="ì¹´í†¡ ëŒ€í™” ë‚´ìš©ì„ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”..." rows="3"
                        class="flex-1 p-3 border rounded-xl resize-none focus:outline-none focus:ring-2 focus:ring-orange-400 disabled:bg-gray-50"
                        onkeydown="if(event.key==='Enter'&&!event.shiftKey){event.preventDefault();sendMessage();}"></textarea>
                    <button onclick="sendMessage()" id="send-btn" class="p-4 bg-orange-500 hover:bg-orange-600 text-white rounded-xl text-xl disabled:opacity-50">ğŸ“¤</button>
                </div>
                <p class="text-xs text-gray-400 mt-2 text-center">ğŸ’¡ íŒ: "ì´ë¦„: ë‚´ìš©" í˜•ì‹ìœ¼ë¡œ ì…ë ¥í•˜ë©´ ë” ì •í™•í•´ìš”</p>
            </div>
        </div>

        <div class="bg-gray-100 p-2 text-center text-xs text-gray-500">âš ï¸ ìƒì„±ëœ ë‹µì¥ì€ ì°¸ê³ ìš©ì…ë‹ˆë‹¤. | Powered by Upstage Solar API</div>
    </div>

    <script>
        let selectedTone = 'polite';
        let isLoading = false;

        function setTone(tone) {
            selectedTone = tone;
            document.querySelectorAll('.tone-btn').forEach(btn => {
                btn.className = 'tone-btn px-4 py-2 rounded-full text-sm font-medium bg-gray-100 text-gray-700 hover:bg-gray-200';
            });
            document.getElementById('tone-' + tone).className = 'tone-btn px-4 py-2 rounded-full text-sm font-medium bg-orange-500 text-white shadow-md';
        }

        function addMessage(content, isUser) {
            const div = document.createElement('div');
            div.className = 'flex ' + (isUser ? 'justify-end' : 'justify-start');
            div.innerHTML = `<div class="max-w-[85%] rounded-2xl p-4 shadow-md ${isUser ? 'bg-yellow-400 text-gray-900' : 'bg-white text-gray-800 border'}">
                <div class="text-sm whitespace-pre-wrap leading-relaxed">${isUser ? escapeHtml(content) : formatResponse(content)}</div>
            </div>`;
            document.getElementById('messages').appendChild(div);
            document.getElementById('chat-container').scrollTop = document.getElementById('chat-container').scrollHeight;
            return div;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function formatResponse(text) {
            return text.split('\n').map(line => {
                if (line.startsWith('[') && line.includes(']')) return `<p class="font-bold text-orange-600 mt-3 mb-1">${line}</p>`;
                return `<p class="my-0.5">${line}</p>`;
            }).join('');
        }

        function updateLastMessage(content) {
            const messages = document.getElementById('messages');
            const last = messages.lastElementChild;
            if (last) last.querySelector('.whitespace-pre-wrap').innerHTML = formatResponse(content);
            document.getElementById('chat-container').scrollTop = document.getElementById('chat-container').scrollHeight;
        }

        async function sendMessage() {
            const input = document.getElementById('text-input');
            const text = input.value.trim();
            if (!text || isLoading) return;

            input.value = '';
            isLoading = true;
            document.getElementById('send-btn').textContent = 'â³';
            document.getElementById('send-btn').disabled = true;
            document.getElementById('text-input').disabled = true;

            addMessage(text, true);
            addMessage('ğŸ’­ ë‹µì¥ì„ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤...', false);

            try {
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ conversation: text, tone: selectedTone })
                });
                const data = await response.json();
                
                if (data.success && data.reply) {
                    updateLastMessage(data.reply);
                } else {
                    updateLastMessage('âŒ ì˜¤ë¥˜: ' + (data.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                }
            } catch (error) {
                updateLastMessage('âŒ ì˜¤ë¥˜: ' + error.message);
            } finally {
                isLoading = false;
                document.getElementById('send-btn').textContent = 'ğŸ“¤';
                document.getElementById('send-btn').disabled = false;
                document.getElementById('text-input').disabled = false;
            }
        }
    </script>
</body>
</html>
